<!-- views/timeAdd.ejs -->
<!doctype html>
<html>
<head>
    <title>TimeLog - Data Management - Add/Remove Time</title>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/style_final.css" type="text/css">
    <link rel="stylesheet" href="../css/multi-select.css" media="screen" type="text/css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/buttons/1.4.2/css/buttons.dataTables.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">


    <!--<link rel="stylesheet" href="//unpkg.com/flatpickr/dist/flatpickr.min.css">-->
    <script src="../3rdPartyLibs/jquery-3.3.1.min.js"></script>
    <script src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="//cdn.datatables.net/buttons/1.4.2/js/dataTables.buttons.min.js"></script>
    <!--<script src="//unpkg.com/flatpickr"></script>-->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="../3rdPartyLibs/jquery.multi-select.js"></script>
    <script src="../3rdPartyLibs/jquery-validation-1.17.0/dist/jquery.validate.js"></script>
    <script src="https://www.google.com/recaptcha/api.js?render=6LcI7LgZAAAAAIl8kDHY2BDminATB5SWG86wzPx9"></script>
    <?php include 'reCaptcha.php';?>
    <style>
        table, th{
            border: 1px solid black;
            text-align:center;
        }
        body { padding-bottom:80px; word-wrap:break-word; }
        .btn{
            font-size:18px;
            text-align:center;
            width:80px;
            padding:5px 5px;
        }
        .button1 {
            width: 49%;
            height: 60px;
            border-radius:0px;
            font-size:16px;
            -webkit-transition-duration: 0.4s;
            transition-duration: 0.4s;
            cursor: pointer;
            background-color: white;
            color: #f0ad4e;
            border: 1px solid #f0ad4e;
        }
        .button1:hover {
            background-color: #f0ad4e;
            color: white;
        }
        .button2 {
            width: 500px;
            height: 50px;
            border-radius: 15px;
            -webkit-transition-duration: 0.4s;
            transition-duration: 0.4s;
            cursor: pointer;
            background-color: lightgray;
            color: #ffffff;
        }

        /*#checkit{*/
        /*    width: 250px;*/
        /*    height: 50px;*/
        /*    border-radius:15px;*/
        /*    font-size:16px;*/
        /*    -webkit-transition-duration: 0.4s;*/
        /*    transition-duration: 0.4s;*/
        /*    color:white;*/
        /*}*/
        input[type="text"] {
            height: 60px;
        }
        input[type="email"] {
            height: 60px;
        }
        input[type="password"] {
            height: 60px;
        }
        /*#capsWarning {*/
        /*    color: red;*/
        /*    text-align: center;*/
        /*}*/
    </style>

</head>
<div class="navul" style="height: 80px;
    background: #000000;">
    <a class="navul" href="//aworldbridge.com" style="background: #000000;
    width: 500px;
    height: 80px;">
        <img class="banner" src="../images/NewWBBanner.jpg" style="width: 550px;
    height: 80px;
    margin: auto; display: block;" />
    </a>
</div>
<body ononline="onFunction()" onoffline="offFunction()">
<div class="container" style="width: 850px;">
    <div class="page-header">
        <h1 class="text-center" style="margin-bottom: 0px"><span class=" text-center fa fa-sign-in"></span><strong> Add and Remove Time </strong></h1>
        <!-- show any messages that come back with authentication -->
        <% if (message.length > 0) { %>
            <div class="alert alert-danger">
                <%= message %>
            </div>
        <% } %>
    </div>
    <div class="generalForm">
        <form class="well form-horizontal" id="editForm" action="/editUser" method="post">
            <fieldset>
                <div class="form-group">
                    <label class="col-md-4 control-label">Username:</label>
                    <div class="col-md-8 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span><input id="username" name="username" class="form-control" placeholder="<%= user.username %>" value="<%= user.username %>" readonly type="email" minlength="2" maxlength="99" autofocus>
                        </div>
                        <p style="margin-top:8px;color:#0088d8;" id="emailc"></p>
                        <p id="emailUser" style="text-align: center; color: palevioletred; margin-top:15px;"></p>
                        <br>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-4 control-label">First Name:</label>
                    <div class="col-md-8 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span><input id="firstName" name="firstName" class="form-control" readonly value="" type="text" minlength="1" maxlength="99" required>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-4 control-label">Last Name:</label>
                    <div class="col-md-8 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span><input id="lastName" name="lastName" class="form-control" readonly value="" type="text" minlength="1" maxlength="99" required>
                        </div>
                    </div>
                </div>
<!--                <div class="form-group">-->
<!--                    <label class="col-md-4 control-label">User Role:</label>-->
<!--                    <div class="col-md-8 inputGroupContainer">-->
<!--                        <div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>-->
<!--                            <select id="userrole" name="User_Role" class="form-control" style="height: 50px;">-->
<!--                                <option class="admin" value="Admin">Admin</option>-->
<!--                                <option class="regular" value="Regular">Regular</option>-->
<!--                            </select>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="form-group">-->
<!--                    <label class="col-md-4 control-label">Status:</label>-->
<!--                    <div class="col-md-8 inputGroupContainer">-->
<!--                        <div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>-->
<!--                            <select id="status" name="status" class="form-control" style="height: 50px;">-->
<!--                                <option class="active" value="Active">Active</option>-->
<!--                                <option class="suspended" value="Suspended">Suspended</option>-->
<!--                                <option class="pending" value="Pending">Pending</option>-->
<!--                                <option class="never_logged_in" value="Never Logged In">Never Logged In</option>-->
<!--                            </select>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
                <div class="form-group">
                    <label class="col-md-4 control-label">Hours to Add/Remove:</label>
                    <div class="col-md-8 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span><input id="hours" name="hours" class="form-control"  value="" type="number" min = '0' required>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-4 control-label">Minutes to Add/Remove:</label>
                    <div class="col-md-8 inputGroupContainer">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span><input id="minutes" name="minutes" class="form-control"  value="" type="number" min="0" required>
                        </div>
                    </div>
                </div>
                <div class="form-group" hidden>
                    <label>Date Modified:</label>
                    <input type="text" id="date" class="form-control" name="dateModified" readonly>
                </div>
                <div class="form-group" hidden>
                    <label>Modified By:</label>
                    <input type="text" id="modUser" class="form-control" name="modifiedUser" readonly>
                </div>
            </fieldset>
            <input type="hidden" id="token">
        </form>
    </div>
<!--    <p style="font-size:15px">-->
<!--        <label for="password" >Do you want to change the following user's password?</label>-->
<!--        <input type="checkbox" id="password" name="password" onclick="changePass()" autofocus>-->
<!--        &lt;!&ndash;-<br><br><input type="checkbox" onclick="changePass()">Show Password&#45;&#45;&ndash;&gt;-->
<!--    </p>-->
<!--    <h3 id="passTitle" class="text-center page-header" style="display: none">Password Change</h3>-->
<!--    <div class="generalForm">-->
<!--        <form id="pswchange" style="display:none;" class="well form-horizontal">-->
<!--            <fieldset>-->
<!--                <p id="capsWarning" hidden><strong>WARNING: Caps lock is enabled.</strong></p>-->
<!--                &lt;!&ndash;                        <div class="form-group currPass" style="display: none">&ndash;&gt;-->
<!--                &lt;!&ndash;                            <label id="displayCurrentPassword" class="col-md-4 control-label">Current Password:</label>&ndash;&gt;-->
<!--                &lt;!&ndash;                            <div class="col-md-8 inputGroupContainer">&ndash;&gt;-->
<!--                &lt;!&ndash;                                <span toggle="#currentPassword" class="fa fa-fw fa-eye-slash field-icon toggle-password" style="float: right; margin-top: 20px"></span>&ndash;&gt;-->
<!--                &lt;!&ndash;                                <div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span><input id="currentPassword" name="CurrentPassword" class="form-control"   value="" type="password"></div>&ndash;&gt;-->
<!--                &lt;!&ndash;                            </div>&ndash;&gt;-->
<!--                &lt;!&ndash;                        </div>&ndash;&gt;-->
<!--                <div class="form-group">-->
<!--                    <label class="col-md-4 control-label">New Password:</label>-->
<!--                    <div class="col-md-8 inputGroupContainer">-->
<!--                        <span toggle="#newPassword" class="fa fa-fw fa-eye-slash field-icon toggle-password" style="float: right; margin-top: 20px"></span>-->
<!--                        <div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span><input id="newPassword" name="NewPassword" class="form-control" value="" type="password"></div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="form-group">-->
<!--                    <label class="col-md-4 control-label">Confirm New Password:</label>-->
<!--                    <div class="col-md-8 inputGroupContainer">-->
<!--                        <span toggle="#confirmPassword" class="fa fa-fw fa-eye-slash field-icon toggle-password" style="float: right; margin-top: 20px"></span>-->
<!--                        <div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span><input id="confirmPassword" name="ConfirmNewPassword" class="form-control"  value="" type="password"></div>-->
<!--                    </div>-->
<!--                </div>-->

<!--            </fieldset>-->
<!--        </form>-->
<!--        <button id="checkit" class="btn-primary text-center" style="display:none; margin-top:-57px; margin-left: 410px;" onclick="checkForm()">Check</button>-->
<!--    </div>-->
    <br>
    <button id="add" type="submit" class="button1" onclick="addTime();" > Add </button>
    <button id="remove" type = "submit" class="button1" onclick="removeTime();" > Remove</button>
    <hr>
    <div class="text-center">
        <a href="/userManagement" >Cancel</a>
    </div>

    <!--</div>-->
</div>
<script>
    let LoginUser = "<%= user.username %>";

    $(function () {
        flatpickr(".date", {
            enableTime: true,
            dateFormat: "Y-m-d H:i:S",
            time_24hr: true
        });
    });
    let today = new Date();
    let date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
    let time2 = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
    let dateTime = date + ' ' + time2;
    // document.getElementById("date").value = dateTime;
    document.getElementById("date").value = dateTime;



    let getvalue = JSON.parse(localStorage.getItem("getvalue"));
    let editUser = getvalue[0];
    console.log(getvalue);
    console.log(editUser);
    let queryStr1 = "&editUser=" + editUser;
    document.getElementById('username').value = getvalue[0];
    document.getElementById('firstName').value = getvalue[1];
    document.getElementById('lastName').value = getvalue[2];

    document.getElementById('username').placeholder = getvalue[0];
    document.getElementById('firstName').placeholder = getvalue[1];
    document.getElementById('lastName').placeholder = getvalue[2];

    document.getElementById('modUser').value = LoginUser;

    let password = $("#password");
    let initial = password.is(":checked");
    let change = $("#password_change")[initial ? "removeClass" : "addClass"]("gray");
    let changeInputs = change.find("input").attr("disabled", !initial);


    function addTime(){
        let day = date;
        let user = document.getElementById("username").value;
        let hours = document.getElementById("hours").value;
        let minutes = document.getElementById("minutes").value;
        $.ajax({
            url: 'add',
            data: {day, user,hours, minutes},
            method: 'post',
            dataType: 'json',
            success: function(results){
                alert(results);
            }
        })
    }

    function removeTime(){
        let day = date;
        let user = document.getElementById("username").value;
        let hours = document.getElementById("hours").value;
        let minutes = document.getElementById("minutes").value;
        $.ajax({
            url: 'remove',
            data: {day, user,hours, minutes},
            method: 'post',
            dataType: 'json',
            success: function(results){
                alert(results);
            }
        })
    }

    grecaptcha.ready(function() {
        grecaptcha.execute('6LcI7LgZAAAAAIl8kDHY2BDminATB5SWG86wzPx9', {action: '/edituserform'}).then(function (token) {
            console.log(token);
            document.getElementById("token").value = token;
        });
    });


    function onFunction() {
        alert ("You are now online.");
    }

    function offFunction() {
        alert ("Your are offline. Some functionality may be unavailable.");
    }




</script>
</body>
</html>
